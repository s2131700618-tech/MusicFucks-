-- ğŸš€ å®Œå…¨è§£ç¦ç‰ˆï¼šç§»é™¤éŸ³é‡ä¸Šé™ + å››éšæ®µæµå…‰ + æ·±åº¦æ¸…ç†
local Player = game:GetService("Players").LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")

-- 1. ã€éŸ³è¨Šæ¸…ç†ã€‘åœæ­¢ä¸¦åˆªé™¤èˆŠè²éŸ³ï¼Œé˜²æ­¢ç–ŠåŠ æ’­æ”¾
local oldSound = Player:FindFirstChild("FinalSound")
if oldSound then
    oldSound:Stop()
    oldSound:Destroy()
    task.wait(0.1)
end

-- 2. ã€UI æ¸…ç†ã€‘ç¢ºä¿èˆŠçš„è®Šè‰² Loop åœæ­¢
local oldUI = PlayerGui:FindFirstChild("MusicControl_MasterV9")
if oldUI then 
    oldUI:SetAttribute("Closed", true) 
    oldUI:Destroy() 
end

-- å»ºç«‹å…¨æ–°è²éŸ³ç‰©ä»¶
local sound = Instance.new("Sound")
sound.Name = "FinalSound"
sound.Looped = true
sound.Parent = Player

local sg = Instance.new("ScreenGui", PlayerGui)
sg.Name = "MusicControl_MasterV9"
sg.ResetOnSpawn = false
sg.DisplayOrder = 100000
sg:SetAttribute("Closed", false)

-- --- ä¸»é¢æ¿ (360x280 å®Œç¾æ¯”ä¾‹) ---
local frame = Instance.new("Frame", sg)
frame.Size = UDim2.new(0, 360, 0, 280)
frame.Position = UDim2.new(0.5, -180, 0.5, -140)
frame.BackgroundColor3 = Color3.fromRGB(12, 12, 12)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 10)

-- ğŸŒˆ æ¨™é¡Œåˆ—ï¼šå››éšæ®µæµå…‰æ¼¸å±¤
local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 45)
title.Text = "Ultra éŸ³æ¨‚æ§åˆ¶å™¨ V6.1"
title.TextSize = 24
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
title.BorderSizePixel = 0
Instance.new("UICorner", title).CornerRadius = UDim.new(0, 10)

local gradient = Instance.new("UIGradient", title)
local phases = {
    {Left = Color3.fromRGB(255, 165, 0), Right = Color3.fromRGB(255, 0, 0)},   -- 1. å·¦æ©™å³ç´…
    {Left = Color3.fromRGB(255, 255, 0), Right = Color3.fromRGB(255, 165, 0)}, -- 2. å·¦é»ƒå³æ©™
    {Left = Color3.fromRGB(0, 255, 120), Right = Color3.fromRGB(0, 120, 255)}, -- 3. å·¦ç¶ å³è—
    {Left = Color3.fromRGB(0, 255, 255), Right = Color3.fromRGB(170, 0, 255)}, -- 4. å·¦é’å³ç´«
}

task.spawn(function()
    local step, progress = 1, 0
    while true do
        if sg:GetAttribute("Closed") == true then break end
        progress = progress + 0.08
        if progress >= 1 then progress = 0 step = (step % #phases) + 1 end
        local nextStep = (step % #phases) + 1
        gradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, phases[step].Left:Lerp(phases[nextStep].Left, progress)),
            ColorSequenceKeypoint.new(1, phases[step].Right:Lerp(phases[nextStep].Right, progress))
        })
        RunService.RenderStepped:Wait()
    end
end)

-- ğŸ› ï¸ è§£ç¦ç‰ˆåŒæ­¥å‡½æ•¸ (æ ¸å¿ƒä¿®æ”¹é»)
local function createInput(name, pos, default)
    local label = Instance.new("TextLabel", frame)
    label.Size = UDim2.new(0, 70, 0, 30)
    label.Position = UDim2.new(0, 10, 0, pos)
    label.Text = name
    label.TextColor3 = Color3.fromRGB(200, 200, 200)
    label.BackgroundTransparency = 1
    label.TextXAlignment = Enum.TextXAlignment.Right
    
    local box = Instance.new("TextBox", frame)
    box.Size = UDim2.new(0, 250, 0, 30)
    box.Position = UDim2.new(0, 90, 0, pos)
    box.Text = default
    box.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    box.TextColor3 = Color3.fromRGB(255, 255, 255)
    box.ClearTextOnFocus = false -- é»æ“Šä¸æ¶ˆå¤±æ–‡å­—
    Instance.new("UICorner", box).CornerRadius = UDim.new(0, 8)
    return box
end

local idBox = createInput("ID:", 60, "")
local volBox = createInput("éŸ³é‡:", 100, "1")
local spdBox = createInput("é€Ÿåº¦:", 140, "1")

-- ã€è§£ç¦é‚è¼¯ã€‘ç›´æ¥è®€å–æ•¸å€¼ï¼Œä¸ä½¿ç”¨ math.clamp é™åˆ¶
local function sync()
    local v = tonumber(volBox.Text) or 0
    local s = tonumber(spdBox.Text) or 1
    sound.Volume = v
    sound.PlaybackSpeed = s
end

volBox:GetPropertyChangedSignal("Text"):Connect(sync)
spdBox:GetPropertyChangedSignal("Text"):Connect(sync)

-- ğŸ”„ å¾ªç’°æ’­æ”¾æŒ‰éˆ•
local loopBtn = Instance.new("TextButton", frame)
loopBtn.Size = UDim2.new(0.9, 0, 0, 35)
loopBtn.Position = UDim2.new(0.05, 0, 0, 185)
loopBtn.BackgroundColor3 = Color3.fromRGB(40, 120, 40)
loopBtn.Text = "ğŸ”„ å¾ªç’°æ’­æ”¾: é–‹å•Ÿ"
loopBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
loopBtn.Font = Enum.Font.GothamBold
Instance.new("UICorner", loopBtn).CornerRadius = UDim.new(0, 8)

loopBtn.Activated:Connect(function()
    sound.Looped = not sound.Looped
    loopBtn.Text = sound.Looped and "ğŸ”„ å¾ªç’°æ’­æ”¾: é–‹å•Ÿ" or "âŒ å¾ªç’°æ’­æ”¾: é—œé–‰"
    loopBtn.BackgroundColor3 = sound.Looped and Color3.fromRGB(40, 120, 40) or Color3.fromRGB(120, 40, 40)
end)

-- â–¶ï¸ æ’­æ”¾æŒ‰éˆ•
local playBtn = Instance.new("TextButton", frame)
playBtn.Size = UDim2.new(0.9, 0, 0, 40)
playBtn.Position = UDim2.new(0.05, 0, 0, 230)
playBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
playBtn.Text = "â–¶ï¸ æ’­æ”¾ / åœæ­¢"
playBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
playBtn.Font = Enum.Font.GothamBold
Instance.new("UICorner", playBtn).CornerRadius = UDim.new(0, 8)

playBtn.Activated:Connect(function()
    if sound.IsPlaying then 
        sound:Stop() 
    else
        local id = idBox.Text:match("%d+")
        if id then 
            sound.SoundId = "rbxassetid://"..id 
            sync() 
            sound:Play() 
        end
    end
end)

-- ğŸµ å´é‚Šé–‹é—œ
local openBtn = Instance.new("TextButton", sg)
openBtn.Size = UDim2.new(0, 50, 0, 50)
openBtn.Position = UDim2.new(0, 10, 0.5, -25)
openBtn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
openBtn.BackgroundTransparency = 0.4
openBtn.Text = "ğŸµ"
openBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
openBtn.TextSize = 30
openBtn.ZIndex = 2000000 
Instance.new("UICorner", openBtn).CornerRadius = UDim.new(0, 12)

openBtn.Activated:Connect(function() frame.Visible = not frame.Visible end)
