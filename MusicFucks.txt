local P, RS = game:GetService("Players").LocalPlayer, game:GetService("RunService")
local PG = P:WaitForChild("PlayerGui")

-- 1. å¾¹åº•æ¸…é™¤èˆŠç‰ˆ
if PG:FindFirstChild("UltraV6_FinalFixed") then PG.UltraV6_FinalFixed:Destroy() end

local sound = P:FindFirstChild("UltraSnd") or Instance.new("Sound", P)
sound.Name = "UltraSnd"
sound.Looped = true

local sg = Instance.new("ScreenGui", PG)
sg.Name = "UltraV6_FinalFixed"
sg.ResetOnSpawn = false
sg.DisplayOrder = 999 -- ç¢ºä¿ UI åœ¨æ‰€æœ‰æ±è¥¿æœ€å‰é¢
sg.ZIndexBehavior = Enum.ZIndexBehavior.Global -- æš´åŠ›å±¤ç´šç®¡ç†

-- --- ä¸»é¢æ¿ ---
local frame = Instance.new("Frame", sg)
frame.Size = UDim2.new(0, 360, 0, 300)
frame.Position = UDim2.new(0.5, -180, 0.5, -150)
frame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
frame.Active, frame.Draggable = true, true
frame.Visible = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 10)

-- â¬› æ¨™é¡Œæ¡†
local bar = Instance.new("Frame", frame)
bar.Size = UDim2.new(1, 0, 0, 50)
bar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
bar.BorderSizePixel = 0
Instance.new("UICorner", bar)

-- ğŸŒˆ éœ“è™¹æµå…‰æ–‡å­— (æ–‡å­—è®Šè‰²ï¼Œæ¡†ä¸è®Š)
local title = Instance.new("TextLabel", bar)
title.Size = UDim2.new(1, 0, 1, 0)
title.BackgroundTransparency = 1
title.Text = "Ultra éŸ³æ¨‚æ§åˆ¶å™¨ V6.1"
title.TextSize = 24
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.new(1, 1, 1)

local grad = Instance.new("UIGradient", title)
local phases = {
    {L = Color3.fromRGB(255, 165, 0), R = Color3.fromRGB(255, 0, 0)},
    {L = Color3.fromRGB(255, 255, 0), R = Color3.fromRGB(255, 165, 0)},
    {L = Color3.fromRGB(0, 255, 120), R = Color3.fromRGB(0, 120, 255)},
    {L = Color3.fromRGB(0, 255, 255), R = Color3.fromRGB(170, 0, 255)},
}

task.spawn(function()
    local s, p = 1, 0
    while sg.Parent do
        p = p + 0.03
        if p >= 1 then p = 0 s = (s % #phases) + 1 end
        local n = (s % #phases) + 1
        grad.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, phases[s].L:Lerp(phases[n].L, p)),
            ColorSequenceKeypoint.new(1, phases[s].R:Lerp(phases[n].R, p))
        })
        RS.RenderStepped:Wait()
    end
end)

-- ğŸ› ï¸ åŠŸèƒ½è¼¸å…¥ (ID/éŸ³é‡/é€Ÿåº¦)
local function createInp(txt, pos, def)
    local l = Instance.new("TextLabel", frame)
    l.Size, l.Position, l.Text, l.TextColor3, l.BackgroundTransparency = UDim2.new(0, 70, 0, 35), UDim2.new(0, 10, 0, pos), txt, Color3.new(0.8,0.8,0.8), 1
    l.Font, l.TextXAlignment = Enum.Font.GothamBold, Enum.TextXAlignment.Right
    local b = Instance.new("TextBox", frame)
    b.Size, b.Position, b.Text, b.BackgroundColor3, b.TextColor3 = UDim2.new(0, 250, 0, 35), UDim2.new(0, 90, 0, pos), def, Color3.fromRGB(30,30,30), Color3.new(1,1,1)
    b.ClearTextOnFocus = false
    Instance.new("UICorner", b)
    return b
end

local idBox = createInp("ID:", 65, "")
local volBox = createInp("éŸ³é‡:", 110, "1")
local spdBox = createInp("é€Ÿåº¦:", 155, "1")

-- ğŸ”˜ æŒ‰éˆ• (åŠ å…¥è§¸è¦ºåé¥‹)
local function makeBtn(txt, pos, col, func)
    local b = Instance.new("TextButton", frame)
    b.Size, b.Position, b.BackgroundColor3 = UDim2.new(0.9, 0, 0, 40), UDim2.new(0.05, 0, 0, pos), col
    b.Text, b.TextColor3, b.Font = txt, Color3.new(1,1,1), Enum.Font.GothamBold
    b.AutoButtonColor = true
    Instance.new("UICorner", b)
    b.MouseButton1Click:Connect(func) -- ä½¿ç”¨æ›´ç©©å®šçš„ Click äº‹ä»¶
    return b
end

local loopBtn = makeBtn("ğŸ”„ å¾ªç’°æ’­æ”¾: é–‹å•Ÿ", 205, Color3.fromRGB(40,110,40), function()
    sound.Looped = not sound.Looped
    loopBtn.Text = sound.Looped and "ğŸ”„ å¾ªç’°æ’­æ”¾: é–‹å•Ÿ" or "âŒ å¾ªç’°æ’­æ”¾: é—œé–‰"
    loopBtn.BackgroundColor3 = sound.Looped and Color3.fromRGB(40,110,40) or Color3.fromRGB(110,40,40)
end)

makeBtn("â–¶ï¸ æ’­æ”¾ / åœæ­¢", 250, Color3.fromRGB(0,100,200), function()
    if sound.IsPlaying then sound:Stop() else
        local id = idBox.Text:match("%d+")
        if id then 
            sound.SoundId = "rbxassetid://"..id 
            sound.Volume = tonumber(volBox.Text) or 1
            sound.PlaybackSpeed = tonumber(spdBox.Text) or 1
            sound:Play() 
        end
    end
end)

-- ğŸµ MF/I|O å´é‚Šé–‹é—œ (è§£æ±ºæŒ‰ä¸äº†çš„å•é¡Œ)
local open = Instance.new("TextButton", sg)
open.Name = "ToggleOpen"
open.Size = UDim2.new(0, 90, 0, 40)
open.Position = UDim2.new(0.85, 0, 0.15, 0)
open.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
open.Text = "MF/I|O"
open.TextSize = 24
open.TextColor3 = Color3.new(1, 1, 1)
open.Font = Enum.Font.GothamBold
open.ZIndex = 9999 -- æ¥µé«˜å±¤ç´š
open.Draggable = true 
open.Active = true 
Instance.new("UICorner", open)
Instance.new("UIStroke", open).Color = Color3.new(1,1,1)

-- æ ¸å¿ƒä¿®æ­£ï¼šä½¿ç”¨ MouseButton1Click ä¸¦ç¢ºä¿ frame.Visible ç‹€æ…‹åˆ‡æ›æ­£ç¢º
open.MouseButton1Click:Connect(function()
    print("Toggle Clicked") -- å¯ä»¥åœ¨ F9 æª¢æŸ¥æ˜¯å¦æœ‰å°å‡ºé€™è¡Œ
    frame.Visible = not frame.Visible
end)
